# Distributed Arithmetic Expression Calculator

Это распределённый калькулятор арифметических выражений, реализованный на Go. Система состоит из двух основных компонентов:

- **Оркестратор**  
  Принимает выражения от пользователя, парсит их, разбивает на отдельные вычислительные задачи и управляет очередью задач. Предоставляет HTTP‑API для:
    - Добавления выражения (`POST /api/v1/calculate`)
    - Получения списка выражений (`GET /api/v1/expressions`)
    - Получения конкретного выражения по ID (`GET /api/v1/expressions/{id}`)
    - Получения задачи для агента (`GET /internal/task`)
    - Приёма результата от агента (`POST /internal/task`)

  Кроме того, оркестратор содержит улучшенный frontend, реализованный на Bootstrap, который позволяет пользователю вводить выражение, следить за статусом вычисления и получать результат.

- **Агент**  
  Демон, который постоянно опрашивает оркестратора (GET `/internal/task`), получает задачи, выполняет вычисления с имитацией задержки и отправляет результат обратно (POST `/internal/task`). Агент запускает несколько горутин, число которых определяется переменной среды `COMPUTING_POWER`.

## Особенности

- **Поддержка сложных выражений:**  
  Парсер обрабатывает выражения как с пробелами, так и без, включая круглые скобки. Например:  
  `2+2*(2+5)*3` или `2 + 2 * (2 + 5) * 3`.

- **Задание времени выполнения операций:**  
  Время выполнения (задержки) для операций задается двумя способами:
    1. **Переменные окружения:**
        - `TIME_ADDITION_MS` – время сложения (мс)
        - `TIME_SUBTRACTION_MS` – время вычитания (мс)
        - `TIME_MULTIPLICATIONS_MS` – время умножения (мс)
        - `TIME_DIVISIONS_MS` – время деления (мс)
    2. **Конфигурационный файл (config.json):**  
       Если файл `config.json` найден, система использует значения оттуда. Пример файла:
       ```json
       {
         "time_addition_ms": 1500,
         "time_subtraction_ms": 1500,
         "time_multiplications_ms": 2000,
         "time_divisions_ms": 2000
       }
       ```

- **Масштабируемость:**  
  Благодаря разделению вычислений на отдельные задачи, систему можно масштабировать, добавляя новые машины с агентами.

- **Современный интерфейс:**  
  Frontend реализован с использованием Bootstrap 5, что обеспечивает современный и адаптивный дизайн для ввода выражений и отображения результатов.

## Запуск

### Оркестратор

1. **Конфигурация времени операций:**
    - **Через файл `config.json`:**  
      Создайте файл `config.json` в корневой директории `orchestrator` со следующим содержимым:
      ```json
      {
        "time_addition_ms": 1500,
        "time_subtraction_ms": 1500,
        "time_multiplications_ms": 2000,
        "time_divisions_ms": 2000
      }
      ```
      Если файл существует, параметры будут загружены из него.

    - **Через переменные окружения:**  
      Если файл не найден, время операций берётся из переменных:
      ```bash
      export TIME_ADDITION_MS=1500
      export TIME_SUBTRACTION_MS=1500
      export TIME_MULTIPLICATIONS_MS=2000
      export TIME_DIVISIONS_MS=2000
      ```

2. **Запуск оркестратора:**
   ```bash
   cd orchestrator
   go run main.go

### Агент

1. **Настройка числа рабочих горутин:**
    - Установите переменную COMPUTING_POWER (по умолчанию 2, можно увеличить для масштабирования):
   ```bash
   export COMPUTING_POWER=4
   ```
2. **Запуск агента:**
    ```bash
    cd agent
    go run main.go
    ```
## Использование

### Frontend
* Откройте браузер и перейдите по адресу http://localhost:8080/.
* Вы увидите современную страницу на Bootstrap с формой ввода арифметического выражения.
* Введите выражение, например: 2+2*(2+5)*3 или с пробелами 2 + 2 * (2 + 5) * 3, и нажмите кнопку Вычислить.

### Получение результата:
* После отправки запроса страница отобразит уведомление о принятии задачи с ID.
* Затем с периодическим опросом (каждые 2 секунды) будет обновляться статус выражения.
* После завершения вычисления появится результат в виде уведомления.

## Тестирование
* Также для примера представлена коллекция запросов postman - third_party
* Имеются тесты в /orchestrator
* -> Запуск всех тестов
```bash
cd orchestrator
go test -v ./...
```
* -> Запуск отдельных тестов
```bash
go test -v ./parser
go test -v ./handlers
go test -v ./scheduler
```